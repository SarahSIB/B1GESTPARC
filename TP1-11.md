## 1. Mise en place
ðŸŒž **Installer le serveur NGINX**

- il faut faire une commande `dnf install`
  [yumee@web ~]$ dnf search nginx
Rocky Linux 9 - BaseOS                                                                      2.1 MB/s | 2.3 MB     00:01
Rocky Linux 9 - AppStream                                                                   4.9 MB/s | 8.3 MB     00:01
Rocky Linux 9 - Extras                                                                       23 kB/s |  16 kB     00:00
=============================================== Name Exactly Matched: nginx ================================================
nginx.x86_64 : A high performance web server and reverse proxy server
============================================== Name & Summary Matched: nginx ===============================================
nginx-all-modules.noarch : A meta package that installs all available Nginx modules
nginx-core.x86_64 : nginx minimal core
nginx-filesystem.noarch : The basic directory layout for the Nginx server
nginx-mod-http-image-filter.x86_64 : Nginx HTTP image filter module
nginx-mod-http-perl.x86_64 : Nginx HTTP perl module
nginx-mod-http-xslt-filter.x86_64 : Nginx XSLT module
nginx-mod-mail.x86_64 : Nginx mail modules
nginx-mod-stream.x86_64 : Nginx stream modules
pcp-pmda-nginx.x86_64 : Performance Co-Pilot (PCP) metrics for the Nginx Webserver

[yumee@web ~]$ sudo dnf install nginx
[sudo] password for yumee:
Rocky Linux 9 - BaseOS                                                                       11 kB/s | 4.1 kB     00:00
Rocky Linux 9 - AppStream                                                                    12 kB/s | 4.5 kB     00:00
Rocky Linux 9 - Extras                                                                      8.0 kB/s | 2.9 kB     00:00
Dependencies resolved.
============================================================================================================================
 Package                          Architecture          Version                              Repository                Size
============================================================================================================================
Installing:
 nginx                            x86_64                2:1.20.1-20.el9.0.1                  appstream                 36 k
Installing dependencies:
 nginx-core                       x86_64                2:1.20.1-20.el9.0.1                  appstream                566 k
 nginx-filesystem                 noarch                2:1.20.1-20.el9.0.1                  appstream                8.4 k
 rocky-logos-httpd                noarch                90.15-2.el9                          appstream                 24 k

Transaction Summary
============================================================================================================================
Install  4 Packages

Total download size: 634 k
Installed size: 1.8 M
Is this ok [y/N]: y
Downloading Packages:
(1/4): nginx-filesystem-1.20.1-20.el9.0.1.noarch.rpm                                         71 kB/s | 8.4 kB     00:00
(2/4): rocky-logos-httpd-90.15-2.el9.noarch.rpm                                             123 kB/s |  24 kB     00:00
(3/4): nginx-1.20.1-20.el9.0.1.x86_64.rpm                                                   158 kB/s |  36 kB     00:00
(4/4): nginx-core-1.20.1-20.el9.0.1.x86_64.rpm                                              2.0 MB/s | 566 kB     00:00
----------------------------------------------------------------------------------------------------------------------------
Total                                                                                       925 kB/s | 634 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                    1/1
  Running scriptlet: nginx-filesystem-2:1.20.1-20.el9.0.1.noarch                                                        1/4
  Installing       : nginx-filesystem-2:1.20.1-20.el9.0.1.noarch                                                        1/4
  Installing       : nginx-core-2:1.20.1-20.el9.0.1.x86_64                                                              2/4
  Installing       : rocky-logos-httpd-90.15-2.el9.noarch                                                               3/4
  Installing       : nginx-2:1.20.1-20.el9.0.1.x86_64                                                                   4/4
  Running scriptlet: nginx-2:1.20.1-20.el9.0.1.x86_64                                                                   4/4
  Verifying        : rocky-logos-httpd-90.15-2.el9.noarch                                                               1/4
  Verifying        : nginx-filesystem-2:1.20.1-20.el9.0.1.noarch                                                        2/4
  Verifying        : nginx-2:1.20.1-20.el9.0.1.x86_64                                                                   3/4
  Verifying        : nginx-core-2:1.20.1-20.el9.0.1.x86_64                                                              4/4

Installed:
  nginx-2:1.20.1-20.el9.0.1.x86_64      nginx-core-2:1.20.1-20.el9.0.1.x86_64  nginx-filesystem-2:1.20.1-20.el9.0.1.noarch
  rocky-logos-httpd-90.15-2.el9.noarch

Complete!
ðŸŒž **DÃ©marrer le service NGINX**

[yumee@web ~]$ sudo systemctl start nginx
[sudo] password for yumee:

ðŸŒž **DÃ©terminer sur quel port tourne NGINX**

- vous devez filtrer la sortie de la commande utilisÃ©e pour n'afficher que les lignes demandÃ©es
[yumee@web ~]$ sudo ss -tulnp
Netid State  Recv-Q Send-Q Local Address:Port  Peer Address:Port Process
udp   UNCONN 0      0          127.0.0.1:323        0.0.0.0:*     users:(("chronyd",pid=696,fd=5))
udp   UNCONN 0      0              [::1]:323           [::]:*     users:(("chronyd",pid=696,fd=6))
tcp   LISTEN 0      128          0.0.0.0:22         0.0.0.0:*     users:(("sshd",pid=15416,fd=3))
tcp   LISTEN 0      511          0.0.0.0:80         0.0.0.0:*     users:(("nginx",pid=15665,fd=6),("nginx",pid=15664,fd=6))
tcp   LISTEN 0      128             [::]:22            [::]:*     users:(("sshd",pid=15416,fd=4))
tcp   LISTEN 0      511             [::]:80            [::]:*     users:(("nginx",pid=15665,fd=7),("nginx",pid=15664,fd=7))
[yumee@web ~]$ sudo ss -tulnp | grep nginx
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=15665,fd=6),("nginx",pid=15664,fd=6))
tcp   LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=15665,fd=7),("nginx",pid=15664,fd=7))

- ouvrez le port concernÃ© dans le firewall
  
[yumee@web ~]$ sudo firewall-cmd --permanent --add-port=80/tcp
[sudo] password for yumee:
Sorry, try again.
[sudo] password for yumee:
success
[yumee@web ~]$ sudo firewall-cmd --reload
success



ðŸŒž **DÃ©terminer les processus liÃ©s au service NGINX**

[yumee@web ~]$ ps aux | grep nginx
root       15664  0.0  0.0  11292  1592 ?        Ss   01:10   0:00 nginx: master process /usr/sbin/nginx
nginx      15665  0.0  0.2  15532  5304 ?        S    01:10   0:00 nginx: worker process
yumee      15702  0.0  0.1   6408  2304 pts/0    S+   01:35   0:00 grep --color=auto nginx

ðŸŒž **DÃ©terminer le nom de l'utilisateur qui lance NGINX**

[yumee@web ~]$ cat /etc/passwd | grep nginx
nginx:x:996:993:Nginx web server:/var/lib/nginx:/sbin/nologin

ðŸŒž **Test !**

[yumee@web ~]$ curl http://10.1.1.1:80 | head -n 7
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>HTTP Server Test Page powered by: Rocky Linux</title>
    <style type="text/css">
100  7620  100  7620    0     0   531k      0 --:--:-- --:--:-- --:--:--  572k

## 2. Analyser la conf de NGINX

ðŸŒž **DÃ©terminer le path du fichier de configuration de NGINX**

- faites un `ls -al <PATH_VERS_LE_FICHIER>` pour le compte-rendu
- la conf c'est dans `/etc/` normalement, comme toujours !

ðŸŒž **Trouver dans le fichier de conf**

- les lignes qui permettent de faire tourner un site web d'accueil (la page moche que vous avez vu avec votre navigateur)
  - ce que vous cherchez, c'est un bloc `server { }` dans le fichier de conf
  - vous ferez un `cat <FICHIER> | grep <TEXTE> -A X` pour me montrer les lignes concernÃ©es dans le compte-rendu
    - l'option `-A X` permet d'afficher aussi les `X` lignes aprÃ¨s chaque ligne trouvÃ©e par `grep`
- une ligne qui commence par `include`
  - cette ligne permet d'inclure d'autres fichiers
  - bah ouais, on stocke pas toute la conf dans un seul fichier, sinon Ã§a serait le bordel
  - encore un `cat <FICHIER> | grep <TEXTE>` pour ne montrer que cette ligne
- la ligne qui indique Ã  NGINX qu'il doit s'exÃ©cuter en tant qu'un utilisateur spÃ©cifique

## 3. DÃ©ployer un nouveau site web

ðŸŒž **CrÃ©er un site web**

- bon on est pas en cours de design ici, alors on va faire simplissime
- crÃ©er un sous-dossier dans `/var/www/`
  - par convention, on stocke les sites web dans `/var/www/`
  - votre dossier doit porter le nom `tp1_parc`
- dans ce dossier `/var/www/tp1_parc`, crÃ©ez un fichier `index.html`
  - il doit contenir `<h1>MEOW mon premier serveur web</h1>`

ðŸŒž **GÃ©rer les permissions**

- tout le contenu du dossier  `/var/www/tp1_parc` doit appartenir Ã  l'utilisateur qui lance NGINX

ðŸŒž **Adapter la conf NGINX**

- dans le fichier de conf principal
  - vous supprimerez le bloc `server {}` repÃ©rÃ© plus tÃ´t pour que NGINX ne serve plus le site par dÃ©faut (parce que Ã§a sert Ã  rien le site par dÃ©faut)
  - redÃ©marrez NGINX pour que les changements prennent effet
- crÃ©ez un nouveau fichier de conf
  - il doit Ãªtre nommÃ© correctement
  - il doit Ãªtre placÃ© dans le bon dossier
  - c'est quoi un "nom correct" et "le bon dossier" ?
    - bah vous avez repÃ©rÃ© dans la partie d'avant les fichiers qui sont inclus par le fichier de conf principal non ?
    - crÃ©ez votre fichier en consÃ©quence
  - redÃ©marrez NGINX pour que les changements prennent effet
  - le contenu doit Ãªtre le suivant :
    - il Ã©coute sur un port que vous aurez dÃ©terminÃ© alÃ©atoirement avec `echo $RANDOM`
      - n'oubliez pas d'ouvrir ce port dans le firewall, et fermer l'ancien
    - il dÃ©finit que le site web est stockÃ© dans /var/www/tp1_parc

```nginx
server {
  # le port choisi devra Ãªtre obtenu avec un 'echo $RANDOM' lÃ  encore
  listen <PORT>;

  root /var/www/tp1_parc;
}
```

ðŸŒž **Visitez votre super site web**

- toujours avec une commande `curl` depuis votre PC (ou un navigateur)
